<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piral Plugin Architecture - Interactive Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1, h2 {
            color: #333;
            border-bottom: 2px solid #0078d4;
            padding-bottom: 10px;
        }
        .diagram-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .diagram-title {
            font-weight: bold;
            color: #0078d4;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .mermaid {
            text-align: center;
        }
        .description {
            margin-top: 15px;
            padding: 15px;
            background: #f0f8ff;
            border-left: 4px solid #0078d4;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Piral Plugin Architecture - Interactive Diagrams</h1>
    
    <div class="diagram-container">
        <div class="diagram-title">1. High-Level System Architecture</div>
        <div class="mermaid">
            graph TB
                subgraph "Client Layer"
                    Browser[Web Browser]
                    Mobile[Mobile App]
                    Desktop[Desktop PWA]
                end
                
                subgraph "Azure Front Door"
                    FD[Front Door<br/>Global Load Balancer]
                    WAF[Web Application<br/>Firewall]
                    Cache[Edge Cache]
                end
                
                subgraph "Application Layer"
                    Shell[Piral App Shell<br/>Static Web App]
                    Feed[Feed Service<br/>Functions]
                    Assets[Pilet Assets<br/>Blob Storage]
                end
                
                subgraph "Services Layer"
                    Auth[Authentication<br/>Azure AD B2C]
                    API[API Management]
                    Data[Data Services]
                end
                
                Browser --> FD
                Mobile --> FD
                Desktop --> FD
                
                FD --> WAF
                WAF --> Cache
                Cache --> Shell
                
                Shell --> Feed
                Shell --> Assets
                Shell --> Auth
                Shell --> API
                
                Feed --> Assets
                API --> Data
        </div>
        <div class="description">
            This diagram shows the complete system architecture with Azure Front Door as the global entry point, 
            providing security through WAF and performance through edge caching. The Piral shell and pilets are 
            served as static assets, while dynamic functionality is provided through Azure Functions and API Management.
        </div>
    </div>
    
    <div class="diagram-container">
        <div class="diagram-title">2. Pilet Lifecycle and Loading Strategy</div>
        <div class="mermaid">
            sequenceDiagram
                participant User
                participant Browser
                participant Shell
                participant SW as Service Worker
                participant Feed as Feed Service
                participant CDN
                participant Storage as Blob Storage
                
                User->>Browser: Navigate to App
                Browser->>Shell: Load App Shell
                Shell->>Shell: Initialize Core
                
                Shell->>SW: Check Cache
                SW-->>Shell: Cached Pilet List
                
                Shell->>Feed: Request Pilet Registry
                Feed->>Feed: Check User Permissions
                Feed->>Feed: Filter Applicable Pilets
                Feed-->>Shell: Return Pilet Metadata
                
                Shell->>Shell: Determine Load Priority
                
                loop For Each Priority Group
                    Shell->>CDN: Request Pilet Bundle
                    CDN->>Storage: Fetch if not cached
                    Storage-->>CDN: Pilet Bundle
                    CDN-->>Shell: Deliver Pilet
                    Shell->>Shell: Initialize Pilet
                    Shell->>Browser: Update UI
                end
                
                Shell->>SW: Cache Pilets
                SW->>SW: Store for Offline
        </div>
        <div class="description">
            This sequence diagram illustrates the complete pilet loading process, from initial page load through 
            progressive enhancement. Note the use of Service Worker for caching and the prioritized loading strategy 
            that ensures critical pilets load first.
        </div>
    </div>
    
    <div class="diagram-container">
        <div class="diagram-title">3. Deployment Pipeline Architecture</div>
        <div class="mermaid">
            graph LR
                subgraph "Development"
                    Dev[Developer]
                    IDE[VS Code]
                    Local[Local Piral CLI]
                end
                
                subgraph "Source Control"
                    Git[Git Repository]
                    PR[Pull Request]
                    Review[Code Review]
                end
                
                subgraph "CI/CD Pipeline"
                    Build[Build Stage]
                    Test[Test Stage]
                    Security[Security Scan]
                    Package[Package Stage]
                end
                
                subgraph "Deployment Stages"
                    DevEnv[Development<br/>Environment]
                    Staging[Staging<br/>Environment]
                    Canary[Canary<br/>Deployment]
                    Prod[Production]
                end
                
                subgraph "Azure Infrastructure"
                    Registry[Container Registry]
                    Storage[Blob Storage]
                    FeedSvc[Feed Service]
                    Monitor[Application Insights]
                end
                
                Dev --> IDE
                IDE --> Local
                Local --> Git
                Git --> PR
                PR --> Review
                Review --> Build
                
                Build --> Test
                Test --> Security
                Security --> Package
                
                Package --> Registry
                Registry --> DevEnv
                DevEnv -->|Auto| Staging
                Staging -->|Manual| Canary
                Canary -->|Progressive| Prod
                
                Package --> Storage
                Storage --> FeedSvc
                
                DevEnv --> Monitor
                Staging --> Monitor
                Canary --> Monitor
                Prod --> Monitor
        </div>
        <div class="description">
            The deployment pipeline shows how pilets move from development to production with multiple quality gates 
            and progressive rollout strategies. Each stage has monitoring to ensure issues are caught early.
        </div>
    </div>
    
    <div class="diagram-container">
        <div class="diagram-title">4. Security Architecture</div>
        <div class="mermaid">
            graph TB
                subgraph "Security Perimeter"
                    Internet[Internet Traffic]
                    DDos[DDoS Protection]
                    FD[Azure Front Door]
                    WAF[Web Application Firewall]
                end
                
                subgraph "Authentication Layer"
                    B2C[Azure AD B2C]
                    MFA[Multi-Factor Auth]
                    SSO[Single Sign-On]
                    Tokens[Token Service]
                end
                
                subgraph "Application Security"
                    CSP[Content Security Policy]
                    CORS[CORS Policy]
                    Sandbox[Pilet Sandbox]
                    Validate[Input Validation]
                end
                
                subgraph "Data Security"
                    Encrypt[Encryption at Rest]
                    TLS[TLS in Transit]
                    Keys[Key Vault]
                    RBAC[Role-Based Access]
                end
                
                Internet --> DDos
                DDos --> FD
                FD --> WAF
                WAF --> B2C
                
                B2C --> MFA
                B2C --> SSO
                SSO --> Tokens
                
                Tokens --> CSP
                CSP --> CORS
                CORS --> Sandbox
                Sandbox --> Validate
                
                Validate --> Encrypt
                Validate --> TLS
                Keys --> Encrypt
                Keys --> TLS
                RBAC --> Encrypt
        </div>
        <div class="description">
            Security is implemented in layers, from network protection through Azure Front Door and WAF, 
            to application-level sandboxing of pilets. Each layer provides defense in depth against different 
            threat vectors.
        </div>
    </div>
    
    <div class="diagram-container">
        <div class="diagram-title">5. Data Flow and Communication Patterns</div>
        <div class="mermaid">
            graph TB
                subgraph "Pilet Communication"
                    P1[Pilet 1<br/>Customer Mgmt]
                    P2[Pilet 2<br/>Order Processing]
                    P3[Pilet 3<br/>Analytics]
                    Bus[Event Bus]
                    State[Shared State]
                end
                
                subgraph "API Gateway"
                    Gateway[API Management]
                    RateLimit[Rate Limiting]
                    Transform[Transform]
                    Route[Routing]
                end
                
                subgraph "Backend Services"
                    Customer[Customer Service]
                    Order[Order Service]
                    Analytics[Analytics Service]
                    Cache[Redis Cache]
                end
                
                subgraph "Data Layer"
                    SQL[Azure SQL]
                    Cosmos[Cosmos DB]
                    Blob[Blob Storage]
                    Search[Cognitive Search]
                end
                
                P1 -.->|Publish Event| Bus
                P2 -.->|Subscribe| Bus
                P3 -.->|Subscribe| Bus
                
                P1 --> State
                P2 --> State
                P3 --> State
                
                P1 --> Gateway
                P2 --> Gateway
                P3 --> Gateway
                
                Gateway --> RateLimit
                RateLimit --> Transform
                Transform --> Route
                
                Route --> Customer
                Route --> Order
                Route --> Analytics
                
                Customer --> Cache
                Order --> Cache
                Analytics --> Cache
                
                Customer --> SQL
                Order --> Cosmos
                Analytics --> Search
                Cache --> SQL
        </div>
        <div class="description">
            This diagram shows how pilets communicate with each other through an event bus and shared state, 
            while backend communication goes through the API Gateway for security and rate limiting. 
            Data is stored in appropriate Azure services based on access patterns and requirements.
        </div>
    </div>
    
    <div class="diagram-container">
        <div class="diagram-title">6. Monitoring and Observability</div>
        <div class="mermaid">
            graph LR
                subgraph "Application Metrics"
                    Shell[App Shell]
                    Pilets[Pilets]
                    API[APIs]
                end
                
                subgraph "Collection"
                    SDK[Application Insights SDK]
                    Agent[Monitoring Agent]
                    Traces[Distributed Tracing]
                end
                
                subgraph "Processing"
                    Stream[Stream Analytics]
                    Functions[Azure Functions]
                    ML[Machine Learning]
                end
                
                subgraph "Storage"
                    Insights[Application Insights]
                    Logs[Log Analytics]
                    Metrics[Metrics Store]
                end
                
                subgraph "Visualization"
                    Dashboard[Azure Dashboard]
                    Workbooks[Workbooks]
                    Alerts[Alert Rules]
                    Teams[Teams Integration]
                end
                
                Shell --> SDK
                Pilets --> SDK
                API --> Agent
                
                SDK --> Traces
                Agent --> Traces
                Traces --> Stream
                
                Stream --> Functions
                Stream --> ML
                Functions --> Insights
                ML --> Insights
                
                Insights --> Logs
                Insights --> Metrics
                
                Logs --> Dashboard
                Metrics --> Dashboard
                Dashboard --> Workbooks
                Dashboard --> Alerts
                Alerts --> Teams
        </div>
        <div class="description">
            Comprehensive monitoring covers all aspects of the system, from client-side pilet performance to 
            backend API health. Machine Learning helps identify anomalies, while alerts ensure rapid response 
            to issues.
        </div>
    </div>
    
    <div class="diagram-container">
        <div class="diagram-title">7. Disaster Recovery Strategy</div>
        <div class="mermaid">
            graph TB
                subgraph "Primary Region - East US"
                    PFD[Front Door Primary]
                    PShell[App Shell Primary]
                    PFeed[Feed Service Primary]
                    PStorage[Storage Primary]
                    PData[Database Primary]
                end
                
                subgraph "Secondary Region - West Europe"
                    SFD[Front Door Secondary]
                    SShell[App Shell Secondary]
                    SFeed[Feed Service Secondary]
                    SStorage[Storage Secondary]
                    SData[Database Secondary]
                end
                
                subgraph "Global Services"
                    TM[Traffic Manager]
                    DNS[Azure DNS]
                    Monitor[Global Monitor]
                end
                
                subgraph "Backup & Recovery"
                    Backup[Automated Backups]
                    GeoRep[Geo-Replication]
                    Snapshot[Point-in-Time Snapshots]
                end
                
                DNS --> TM
                TM -->|Active| PFD
                TM -.->|Standby| SFD
                
                PFD --> PShell
                PShell --> PFeed
                PFeed --> PStorage
                PStorage --> PData
                
                SFD --> SShell
                SShell --> SFeed
                SFeed --> SStorage
                SStorage --> SData
                
                PData <-->|Sync| SData
                PStorage <-->|Sync| SStorage
                
                Monitor --> TM
                Monitor -->|Failover| SFD
                
                PData --> Backup
                SData --> Backup
                Backup --> Snapshot
                PStorage --> GeoRep
                SStorage --> GeoRep
        </div>
        <div class="description">
            Multi-region deployment ensures business continuity with automatic failover capabilities. 
            Data is continuously replicated between regions, and Traffic Manager handles routing to healthy endpoints. 
            Recovery Time Objective (RTO) is less than 5 minutes, with Recovery Point Objective (RPO) near zero for critical data.
        </div>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#0078d4',
                primaryTextColor: '#fff',
                primaryBorderColor: '#0053a0',
                lineColor: '#5c5c5c',
                secondaryColor: '#006621',
                tertiaryColor: '#e3f2fd'
            }
        });
    </script>
</body>
</html>
